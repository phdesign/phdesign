




<!DOCTYPE html>
<html lang="en">
  
  <head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Using LINQ to list all duplicates | phdesign</title>

    <!-- Google Web Fonts -->
    <link href='http://fonts.googleapis.com/css?family=Montserrat:400,700' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Merriweather:400,300,300italic,400italic,700,700italic,900,900italic' rel='stylesheet' type='text/css'>

    <!-- Stylesheets -->
    <link rel="stylesheet" href="/assets/css/style.css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Favicon/Touch Icons  -->
    <!-- <link rel="shortcut icon" href="/assets/img/favicon.ico">
    <link rel="apple-touch-icon" href="/assets/img/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/assets/img/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/assets/img/apple-touch-icon-114x114.png"> -->

  </head>

  <body class="post">

    <div class="header-background-image"></div>
    <header role="banner">
      <div class="header-top">
        
        <nav class="navbar navbar-default">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              <a class="navbar-brand" href="/" title="phdesign homepage">ph<span class="brand-muted">design</span></a>
            </div><!-- end .navbar-header -->

            <div class="collapse navbar-collapse" id="navbar-collapse">
              <ul class="nav navbar-nav">
                <li class="active"><a href="/">Home <span class="sr-only">(current)</span></a></li>
                <li class="dropdown">
                  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Blog <span class="caret"></span></a>
                  <ul class="dropdown-menu" role="menu">
                    
                      <li><a href="/programming">programming</a></li>
                    
                      <li><a href="/general">general</a></li>
                    
                      <li><a href="/uncategorized">uncategorized</a></li>
                    
                  </ul>
                </li>
                <li class="dropdown">
                  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Projects <span class="caret"></span></a>
                  <ul class="dropdown-menu" role="menu">
                    <li><a href="/phreplace">phReplace</a></li>
                    <li><a href="/npptoolbucket">NppToolBucket</a></li>
                    <li><a href="/betternote">BetterNote</a></li>
                  </ul>
                </li>
                <li><a href="/contact-me">Contact me</a></li>
              </ul>
            </div><!-- end .navbar-collapse -->
          </div><!-- end .container -->
        </nav>

      </div><!-- end .header-top -->

      

    </header>

    <main class="content">
            <article>
        <div class="container">

          

          <div class="date-stamp">
            <div class="month">Mar</div>
            <div class="day">11</div>
          </div><!-- end .date-stamp -->

          <h2 class="post-header">Using LINQ to list all duplicates</h2>

          <div class="meta-label">posted on <span class="meta-value muted">11 March 2011</span> in <span class="meta-value"><a href="/programming">programming</a></span> with <span class="meta-value"><a data-disqus-identifier="using-linq-to-list-all-duplicates" href="#disqus_thread">0 Comments</a></span></div>
          <br />

          <p>There’s plenty of examples on how to find duplicates using LINQ’s GroupBy method, but usually they use a projection to return a new object, like this:</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">_filteredSubmissions</span> <span class="o">=</span> <span class="p">(</span><span class="nx">from</span> <span class="nx">s</span> <span class="k">in</span> <span class="nx">_filteredSubmissions</span>
                        <span class="nx">group</span> <span class="nx">s</span> <span class="nx">by</span> <span class="nx">s</span><span class="p">.</span><span class="nx">Email</span>
                        <span class="nx">into</span> <span class="nx">g</span>
                        <span class="nx">where</span> <span class="nx">g</span><span class="p">.</span><span class="nx">Count</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">1</span>
                        <span class="nx">select</span> <span class="k">new</span> <span class="p">{</span> <span class="nx">Emails</span> <span class="o">=</span> <span class="nx">g</span><span class="p">.</span><span class="nx">Key</span><span class="p">,</span> <span class="nx">DuplicateCount</span> <span class="o">=</span> <span class="nx">g</span><span class="p">.</span><span class="nx">Count</span><span class="p">()</span> <span class="p">}</span></code></pre></div>

<!--more-->

<p>Which will just return any email addresses that are duplicates and the count. But what if you want to list all the original items that are duplicates? If you just ‘select g’ in the example above you’ll end up with an IEnumerable&lt;IEnumerable<submission>&gt;, not what we want. This is where SelectMany() is perfect, it will flatten our collection of a collection back down to a single collection, perfect!</submission></p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">_filteredSubmissions</span> <span class="o">=</span> <span class="p">(</span><span class="nx">from</span> <span class="nx">s</span> <span class="k">in</span> <span class="nx">_filteredSubmissions</span>
                        <span class="nx">group</span> <span class="nx">s</span> <span class="nx">by</span> <span class="nx">s</span><span class="p">.</span><span class="nx">Email</span>
                        <span class="nx">into</span> <span class="nx">g</span>
                        <span class="nx">where</span> <span class="nx">g</span><span class="p">.</span><span class="nx">Count</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">1</span>
                        <span class="nx">select</span> <span class="nx">g</span><span class="p">).</span><span class="nx">SelectMany</span><span class="p">(</span><span class="nx">g</span> <span class="o">=&gt;</span> <span class="nx">g</span><span class="p">)</span></code></pre></div>

<p>So now I want to find Submissions that have the same first and last names, I use an anonymous type.</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">_filteredSubmissions</span> <span class="o">=</span> <span class="p">(</span><span class="nx">from</span> <span class="nx">s</span> <span class="k">in</span> <span class="nx">_filteredSubmissions</span>
                        <span class="nx">group</span> <span class="nx">s</span> <span class="nx">by</span> <span class="k">new</span> <span class="p">{</span> <span class="nx">s</span><span class="p">.</span><span class="nx">FirstName</span><span class="p">,</span> <span class="nx">s</span><span class="p">.</span><span class="nx">LastName</span> <span class="p">}</span>
                        <span class="nx">into</span> <span class="nx">g</span>
                        <span class="nx">where</span> <span class="nx">g</span><span class="p">.</span><span class="nx">Count</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">1</span>
                        <span class="nx">select</span> <span class="nx">g</span><span class="p">).</span><span class="nx">SelectMany</span><span class="p">(</span><span class="nx">g</span> <span class="o">=&gt;</span> <span class="nx">g</span><span class="p">)</span></code></pre></div>

<p>And finally I want to find all Submissions that have the same first name and last name OR the same email. Simply use Union(), this will join the two collections and remove any duplicates (that’s duplicate instances of the classes, not to be confused with the duplicates we’re trying to find).</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">_filteredSubmissions</span> <span class="o">=</span> <span class="p">(</span><span class="nx">from</span> <span class="nx">s</span> <span class="k">in</span> <span class="nx">_filteredSubmissions</span>
                        <span class="nx">group</span> <span class="nx">s</span> <span class="nx">by</span> <span class="k">new</span> <span class="p">{</span> <span class="nx">s</span><span class="p">.</span><span class="nx">FirstName</span><span class="p">,</span> <span class="nx">s</span><span class="p">.</span><span class="nx">LastName</span> <span class="p">}</span>
                        <span class="nx">into</span> <span class="nx">g</span>
                        <span class="nx">where</span> <span class="nx">g</span><span class="p">.</span><span class="nx">Count</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">1</span>
                        <span class="nx">select</span> <span class="nx">g</span><span class="p">).</span><span class="nx">SelectMany</span><span class="p">(</span><span class="nx">g</span> <span class="o">=&gt;</span> <span class="nx">g</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">Union</span><span class="p">(</span>
        <span class="p">(</span><span class="nx">from</span> <span class="nx">s</span> <span class="k">in</span> <span class="nx">_filteredSubmissions</span>
         <span class="nx">where</span> <span class="o">!</span><span class="nx">string</span><span class="p">.</span><span class="nx">IsNullOrWhiteSpace</span><span class="p">(</span><span class="nx">s</span><span class="p">.</span><span class="nx">Email</span><span class="p">)</span>
         <span class="nx">group</span> <span class="nx">s</span> <span class="nx">by</span> <span class="nx">s</span><span class="p">.</span><span class="nx">Email</span>
         <span class="nx">into</span> <span class="nx">g</span>
         <span class="nx">where</span> <span class="nx">g</span><span class="p">.</span><span class="nx">Count</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">1</span>
         <span class="nx">select</span> <span class="nx">g</span><span class="p">).</span><span class="nx">SelectMany</span><span class="p">(</span><span class="nx">g</span> <span class="o">=&gt;</span> <span class="nx">g</span><span class="p">)</span>
    <span class="p">);</span></code></pre></div>

<p><code> </code><br />
Note that I also stuck in a check for blank emails, I don’t consider a Submission the same just because they both have no email address, I didn’t do this on the FirstName or LastName fields because I know they are mandatory in my system.</p>



          <ul class="post-tags">
            
              <li><a href="/tags/c#" title="View posts tagged with c#">#c#</a></li>
            
              <li><a href="/tags/dotnet" title="View posts tagged with dotnet">#dotnet</a></li>
            
              <li><a href="/tags/howto" title="View posts tagged with howto">#howto</a></li>
            
              <li><a href="/tags/linq" title="View posts tagged with linq">#linq</a></li>
            
          </ul>

          

        </div><!-- end .container -->
      </article>

      <div class="stripe">
        <div class="container">

          <div class="comments">
            <div id="disqus_thread"></div>
            <script type="text/javascript">
              /* * * CONFIGURATION VARIABLES * * */
              var disqus_shortname = 'phdesign';
              var disqus_identifier = 'using-linq-to-list-all-duplicates';
              var disqus_title = 'Using LINQ to list all duplicates';
              var disqus_url = 'http://phdesign.com.au/programming/2011/03/using-linq-to-list-all-duplicates/';

              /* * * DON'T EDIT BELOW THIS LINE * * */
              (function() {
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
              })();
            </script>
            <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
          </div><!-- end .comments -->

        </div><!-- end .container -->
      </div>

      <div class="stripe alt">
        <div class="container">

          <nav class="row pager">
            <div class="previous col-xs-6 col-sm-4">
              
                <div class="meta-label"><a href="/programming/2011/02/unindent-in-expression-blend/"><span aria-hidden="true">&laquo;</span> Previous post</a></div>
                <div class="meta-value"><a href="/programming/2011/02/unindent-in-expression-blend/">Unindent in Expression Blend</a></div>
              
            </div>
            <div class="next col-xs-6 col-sm-4 col-sm-offset-4">
              
                <div class="meta-label"><a href="/programming/2011/06/conditional-validation-in-asp-net-mvc3/">Next post <span aria-hidden="true">&raquo;</span></a></div>
                <div class="meta-value"><a href="/programming/2011/06/conditional-validation-in-asp-net-mvc3/">Conditional Validation in ASP.NET MVC3</a></div>
              
            </div>
          </nav><!-- end .post_nav -->

        </div><!-- end .container -->
      </div><!-- end .stripe.alt -->

    </main><!-- end .content -->

    
    <footer role="contentinfo">
      <div class="container">

        <ul class="social-icons">
          <li><a href="https://twitter.com/pheasley" title="Follow me on Twitter"><i class="fa fa-twitter"></i></a></li>
          <li><a href="https://github.com/phdesign" title="See my code on GitHub"><i class="fa fa-github"></i></a></li>
          <li><a href="https://au.linkedin.com/in/pheasley" title="Connect with me on LinkedIn"><i class="fa fa-linkedin"></i></a></li>
          <li><a href="https://www.pinterest.com/paulheasley/" title="Follow me on Pinterest"><i class="fa fa-pinterest"></i></a></li>
          <li><a href="https://instagram.com/phdesign/" title="Me on Instagram"><i class="fa fa-instagram"></i></a></li>
        </ul>

        <p class="footer-copyright">
          &copy; 2015 Paul Heasley. All rights reserved. <br>
          Based on a <a href="http://guuthemes.com/" title="Much of the design of this site was based on a GuuThemes theme, big credit to their team for their beautiful art and clean code">GuuTheme</a>.
        </p>

      </div><!-- end .container -->
    </footer>

    
    <!-- JS (Javascript Files)
    ================================================== -->

    <script src="/assets/js/main.js"></script>

    <script type="text/javascript">
      /* * * CONFIGURATION VARIABLES * * */
      var disqus_shortname = 'phdesign';

      /* * * DON'T EDIT BELOW THIS LINE * * */
      (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
      }());
    </script>

  </body>

</html>
